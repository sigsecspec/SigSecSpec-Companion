<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time Reference ‚Äî Security Companion</title>
<link rel="stylesheet" href="app-styles.css">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f0f0f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script src="push-notifications.js"></script>
<script src="popup-system.js"></script>
<script src="page-transitions.js"></script>
<style>
  .time-display {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 0.75rem;
    padding: 1.5rem;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .time-value {
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent-primary);
    margin-bottom: 0.5rem;
  }

  .time-label {
    font-size: 0.875rem;
    color: var(--text-secondary);
    font-weight: 600;
  }

  .reference-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  @media (max-width: 768px) {
    .reference-grid {
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }
  }

  .timezone-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 0.75rem;
  }

  @media (max-width: 640px) {
    .timezone-grid {
      grid-template-columns: 1fr;
    }
  }

  .timezone-card {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
    padding: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
  }

  .timezone-card:hover {
    background: var(--bg-secondary);
    transform: translateY(-1px);
  }

  .timezone-city {
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--text-primary);
    margin-bottom: 0.25rem;
  }

  .timezone-abbr {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }

  .timezone-current-time {
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--accent-primary);
  }

  .timezone-date {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 0.25rem;
  }

  .timezone-offset {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    font-size: 0.75rem;
    color: var(--text-muted);
    background: var(--bg-secondary);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
  }

  .time-converter {
    padding: 1rem;
  }

  .converter-input {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }

  .conversion-results {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 0.75rem;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border-primary);
  }

  .conversion-item {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
    padding: 0.75rem;
    text-align: center;
  }

  .conversion-zone {
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-bottom: 0.25rem;
  }

  .conversion-time {
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
  }

  .conversion-date-diff {
    font-size: 0.75rem;
    color: var(--accent-primary);
    margin-top: 0.25rem;
  }

  .search-container {
    margin-bottom: 1.5rem;
  }

  .search-input {
    width: 100%;
    max-width: 400px;
  }

  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .collapse-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: 0.25rem;
    transition: all 0.2s ease;
  }

  .collapse-btn:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }

  .collapsible-content {
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .collapsible-content.collapsed {
    max-height: 0;
    margin-bottom: 0;
  }

  .no-results {
    text-align: center;
    padding: 2rem 1rem;
    color: var(--text-muted);
  }

  .timezone-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .timezone-item {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-radius: 0.5rem;
    padding: 1rem;
    text-align: center;
  }

  .timezone-name {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
  }

  .timezone-time {
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
  }
</style>
</head>
<body class="bg-pattern">

<!-- Header -->
<header class="app-header">
  <div class="flex items-center gap-3">
    <div class="app-logo">
      <img src="patch-bg.png" alt="Security Logo">
    </div>
    <div class="header-content">
      <h1>Time Reference</h1>
      <p>Time zones & conversion chart</p>
    </div>
  </div>
  <div class="header-actions">
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme"></button>
  </div>
</header>

<!-- Emergency Button - Bottom Right -->
<button class="emergency-btn-fixed" onclick="triggerEmergency()" aria-label="Emergency alert">
  üö®
</button>

<main class="main-content">
  <section class="max-w-6xl mx-auto">
    
    <!-- Time Display -->
    <div class="time-display">
      <div class="time-value" id="militaryTime">--:--:--</div>
      <div class="time-label">24-Hour Format</div>
      <div class="timezone-info">
        <div class="timezone-item">
          <div class="timezone-name">Local Time</div>
          <div class="timezone-time" id="localTime">--:--:--</div>
        </div>
        <div class="timezone-item">
          <div class="timezone-name">12-Hour Format</div>
          <div class="timezone-time" id="twelveHourTime">--:--:-- AM/PM</div>
        </div>
        <div class="timezone-item">
          <div class="timezone-name">Date</div>
          <div class="timezone-time" id="currentDate">--/--/----</div>
        </div>
      </div>
    </div>

    <!-- Search -->
    <div class="search-container">
      <input id="globalSearch" class="form-input search-input" placeholder="Search time zones or cities..." />
    </div>

    <!-- World Time Zones Section -->
    <div class="mobile-card">
      <div class="section-header">
        <div class="section-title">
          üåç World Time Zones
        </div>
        <button class="collapse-btn" onclick="toggleSection('world')" id="worldToggle">‚ñº</button>
      </div>
      <div id="worldContent" class="collapsible-content">
        <div id="worldGrid" class="timezone-grid"></div>
        <div id="worldNoResults" class="no-results hidden">No matching time zones found</div>
      </div>
    </div>

    <!-- Time Conversion Tool -->
    <div class="mobile-card">
      <div class="section-header">
        <div class="section-title">
          ‚è∞ Time Converter
        </div>
      </div>
      <div class="time-converter">
        <div class="converter-input">
          <label for="convertTime" class="form-label">Enter Time (HH:MM)</label>
          <input type="time" id="convertTime" class="form-input" />
          <select id="fromTimezone" class="form-input" style="margin-top: 0.5rem;">
            <option value="local">Local Time</option>
            <option value="UTC">GMT</option>
            <option value="America/New_York">EST/EDT</option>
            <option value="America/Chicago">CST/CDT</option>
            <option value="America/Denver">MST/MDT</option>
            <option value="America/Los_Angeles">PST/PDT</option>
            <option value="Europe/London">London</option>
            <option value="Europe/Paris">Paris</option>
            <option value="Asia/Tokyo">Tokyo</option>
            <option value="Asia/Shanghai">Beijing</option>
            <option value="Asia/Dubai">Dubai</option>
            <option value="Australia/Sydney">Sydney</option>
          </select>
          <button class="touch-btn" style="margin-top: 0.5rem; width: 100%;" onclick="convertTime()">Convert</button>
        </div>
        <div id="conversionResults" class="conversion-results hidden"></div>
      </div>
    </div>

  </section>
</main>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
  <div class="nav-grid">
    <a href="index.html" class="nav-item">
      <div class="nav-icon">üè†</div>
      <span>Home</span>
    </a>
    <a href="schedule.html" class="nav-item">
      <div class="nav-icon">üìã</div>
      <span>Schedule</span>
    </a>
    <a href="reports.html" class="nav-item">
      <div class="nav-icon">üìù</div>
      <span>Reports</span>
    </a>
    <a href="patrol.html" class="nav-item">
      <div class="nav-icon">üö∂</div>
      <span>Patrol</span>
    </a>
    <a href="profile.html" class="nav-item">
      <div class="nav-icon">üë§</div>
      <span>Profile</span>
    </a>
  </div>
</nav>

<!-- Emergency Modal -->
<div id="emergencyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
  <div class="mobile-card max-w-sm mx-4">
    <h3 class="text-xl font-bold text-red-500 mb-4">üö® Emergency Alert</h3>
    <p class="mb-6">This will send an emergency alert to dispatch and your supervisor. Continue?</p>
    <div class="flex gap-3">
      <button class="touch-btn flex-1" onclick="cancelEmergency()">Cancel</button>
      <button class="touch-btn danger flex-1" onclick="confirmEmergency()">Send Alert</button>
    </div>
  </div>
</div>

<script>
// Theme management
function toggleTheme() {
  const currentTheme = document.documentElement.getAttribute('data-theme');
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
}

function initTheme() {
  const savedTheme = localStorage.getItem('theme') || 'dark';
  document.documentElement.setAttribute('data-theme', savedTheme);
}

// Emergency functions
function triggerEmergency() {
  document.getElementById('emergencyModal').classList.remove('hidden');
  document.getElementById('emergencyModal').classList.add('flex');
}

function cancelEmergency() {
  document.getElementById('emergencyModal').classList.add('hidden');
  document.getElementById('emergencyModal').classList.remove('flex');
}

function confirmEmergency() {
  navigator.geolocation?.getCurrentPosition(
    (position) => {
      const location = `${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)}`;
      if (window.securityNotifications) {
        window.securityNotifications.sendEmergencyAlert(location, 'Emergency assistance required - immediate response needed');
      }
    },
    () => {
      if (window.securityNotifications) {
        window.securityNotifications.sendEmergencyAlert(null, 'Emergency assistance required - location unavailable');
      }
    }
  );
  
  navigator.vibrate && navigator.vibrate([200, 100, 200, 100, 200]);
  showSuccess('Emergency alert sent to dispatch!');
  cancelEmergency();
}

// Time Management
function updateTimes() {
  const now = new Date();
  
  // Military Time (24-hour format with seconds)
  const militaryTime = now.toLocaleTimeString([], {
    hour12: false,
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  document.getElementById('militaryTime').textContent = militaryTime;
  
  // Local Time (24-hour format)
  const localTime = now.toLocaleTimeString([], {
    hour12: false,
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  document.getElementById('localTime').textContent = localTime;
  
  // 12-Hour Format
  const twelveHourTime = now.toLocaleTimeString([], {
    hour12: true,
    hour: '2-digit',
    minute: '2-digit',
    second: '2-digit'
  });
  const twelveHourEl = document.getElementById('twelveHourTime');
  if (twelveHourEl) {
    twelveHourEl.textContent = twelveHourTime;
  }
  
  // Current Date
  const currentDate = now.toLocaleDateString([], {
    month: '2-digit',
    day: '2-digit',
    year: 'numeric'
  });
  const dateEl = document.getElementById('currentDate');
  if (dateEl) {
    dateEl.textContent = currentDate;
  }
}

// World Time Zones Data
const WORLD_TIMEZONES = [
  // Americas
  { city: 'New York', zone: 'America/New_York', abbr: 'EST/EDT', offset: -5, synonyms: ['nyc', 'eastern'] },
  { city: 'Chicago', zone: 'America/Chicago', abbr: 'CST/CDT', offset: -6, synonyms: ['central'] },
  { city: 'Denver', zone: 'America/Denver', abbr: 'MST/MDT', offset: -7, synonyms: ['mountain'] },
  { city: 'Los Angeles', zone: 'America/Los_Angeles', abbr: 'PST/PDT', offset: -8, synonyms: ['la', 'pacific'] },
  { city: 'Phoenix', zone: 'America/Phoenix', abbr: 'MST', offset: -7, synonyms: ['arizona'] },
  { city: 'Toronto', zone: 'America/Toronto', abbr: 'EST/EDT', offset: -5, synonyms: ['canada'] },
  { city: 'Mexico City', zone: 'America/Mexico_City', abbr: 'CST', offset: -6, synonyms: ['mexico'] },
  { city: 'S√£o Paulo', zone: 'America/Sao_Paulo', abbr: 'BRT', offset: -3, synonyms: ['brazil', 'sao paulo'] },
  { city: 'Buenos Aires', zone: 'America/Argentina/Buenos_Aires', abbr: 'ART', offset: -3, synonyms: ['argentina'] },
  
  // Europe
  { city: 'London', zone: 'Europe/London', abbr: 'GMT/BST', offset: 0, synonyms: ['uk', 'britain', 'gmt'] },
  { city: 'Paris', zone: 'Europe/Paris', abbr: 'CET/CEST', offset: 1, synonyms: ['france'] },
  { city: 'Berlin', zone: 'Europe/Berlin', abbr: 'CET/CEST', offset: 1, synonyms: ['germany'] },
  { city: 'Madrid', zone: 'Europe/Madrid', abbr: 'CET/CEST', offset: 1, synonyms: ['spain'] },
  { city: 'Rome', zone: 'Europe/Rome', abbr: 'CET/CEST', offset: 1, synonyms: ['italy'] },
  { city: 'Moscow', zone: 'Europe/Moscow', abbr: 'MSK', offset: 3, synonyms: ['russia'] },
  { city: 'Athens', zone: 'Europe/Athens', abbr: 'EET/EEST', offset: 2, synonyms: ['greece'] },
  { city: 'Stockholm', zone: 'Europe/Stockholm', abbr: 'CET/CEST', offset: 1, synonyms: ['sweden'] },
  
  // Asia
  { city: 'Dubai', zone: 'Asia/Dubai', abbr: 'GST', offset: 4, synonyms: ['uae'] },
  { city: 'Mumbai', zone: 'Asia/Kolkata', abbr: 'IST', offset: 5.5, synonyms: ['india', 'delhi', 'kolkata'] },
  { city: 'Bangkok', zone: 'Asia/Bangkok', abbr: 'ICT', offset: 7, synonyms: ['thailand'] },
  { city: 'Singapore', zone: 'Asia/Singapore', abbr: 'SGT', offset: 8, synonyms: ['sg'] },
  { city: 'Hong Kong', zone: 'Asia/Hong_Kong', abbr: 'HKT', offset: 8, synonyms: ['hk'] },
  { city: 'Beijing', zone: 'Asia/Shanghai', abbr: 'CST', offset: 8, synonyms: ['china', 'shanghai'] },
  { city: 'Tokyo', zone: 'Asia/Tokyo', abbr: 'JST', offset: 9, synonyms: ['japan'] },
  { city: 'Seoul', zone: 'Asia/Seoul', abbr: 'KST', offset: 9, synonyms: ['korea', 'south korea'] },
  
  // Oceania
  { city: 'Sydney', zone: 'Australia/Sydney', abbr: 'AEDT/AEST', offset: 11, synonyms: ['australia'] },
  { city: 'Melbourne', zone: 'Australia/Melbourne', abbr: 'AEDT/AEST', offset: 11, synonyms: ['vic'] },
  { city: 'Perth', zone: 'Australia/Perth', abbr: 'AWST', offset: 8, synonyms: ['western australia'] },
  { city: 'Auckland', zone: 'Pacific/Auckland', abbr: 'NZDT/NZST', offset: 13, synonyms: ['new zealand', 'nz'] },
  
  // Africa
  { city: 'Cairo', zone: 'Africa/Cairo', abbr: 'EET', offset: 2, synonyms: ['egypt'] },
  { city: 'Lagos', zone: 'Africa/Lagos', abbr: 'WAT', offset: 1, synonyms: ['nigeria'] },
  { city: 'Johannesburg', zone: 'Africa/Johannesburg', abbr: 'SAST', offset: 2, synonyms: ['south africa'] },
  
  // GMT
  { city: 'Greenwich', zone: 'UTC', abbr: 'GMT', offset: 0, synonyms: ['london', 'gmt', 'greenwich mean time'] }
];

// Search and Display Logic
let filteredTimezones = [...WORLD_TIMEZONES];

const normalize = (s) => (s || '').toLowerCase();

function matchesQuery(item, query) {
  if (!query) return true;
  const tokens = query.split(/\s+/).filter(Boolean);
  
  const searchText = normalize([
    item.city,
    item.zone,
    item.abbr,
    ...(item.synonyms || [])
  ].join(' '));
  
  return tokens.every(token => searchText.includes(normalize(token)));
}

function getTimeInZone(zone) {
  try {
    const now = new Date();
    const options = {
      timeZone: zone === 'UTC' ? 'UTC' : zone,
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: false
    };
    return now.toLocaleTimeString('en-US', options);
  } catch (e) {
    return '--:--:--';
  }
}

function getDateInZone(zone) {
  try {
    const now = new Date();
    const options = {
      timeZone: zone === 'UTC' ? 'UTC' : zone,
      month: 'short',
      day: 'numeric'
    };
    return now.toLocaleDateString('en-US', options);
  } catch (e) {
    return '';
  }
}

function renderTimezones() {
  const grid = document.getElementById('worldGrid');
  const noResults = document.getElementById('worldNoResults');
  
  if (filteredTimezones.length === 0) {
    grid.innerHTML = '';
    noResults.classList.remove('hidden');
    return;
  }
  
  noResults.classList.add('hidden');
  grid.innerHTML = filteredTimezones.map(item => {
    const currentTime = getTimeInZone(item.zone);
    const currentDate = getDateInZone(item.zone);
    const offsetStr = item.offset > 0 ? `GMT+${item.offset}` : item.offset === 0 ? 'GMT' : `GMT${item.offset}`;
    
    return `
      <div class="timezone-card" onclick="copyTimezone('${item.city}', '${currentTime}')" title="Click to copy">
        <div class="timezone-offset">${offsetStr}</div>
        <div class="timezone-city">${item.city}</div>
        <div class="timezone-abbr">${item.abbr}</div>
        <div class="timezone-current-time" data-zone="${item.zone}">${currentTime}</div>
        <div class="timezone-date">${currentDate}</div>
      </div>
    `;
  }).join('');
}

function updateAllTimezones() {
  document.querySelectorAll('[data-zone]').forEach(el => {
    const zone = el.dataset.zone;
    el.textContent = getTimeInZone(zone);
    
    // Update date if it's a timezone card
    const dateEl = el.nextElementSibling;
    if (dateEl && dateEl.classList.contains('timezone-date')) {
      dateEl.textContent = getDateInZone(zone);
    }
  });
}

function applySearch(query) {
  filteredTimezones = WORLD_TIMEZONES.filter(item => matchesQuery(item, query));
  renderTimezones();
}

// Time Converter Functions
function convertTime() {
  const timeInput = document.getElementById('convertTime');
  const fromZone = document.getElementById('fromTimezone');
  const results = document.getElementById('conversionResults');
  
  if (!timeInput.value) {
    showSuccess('Please enter a time to convert');
    return;
  }
  
  const [hours, minutes] = timeInput.value.split(':');
  const now = new Date();
  now.setHours(parseInt(hours), parseInt(minutes), 0, 0);
  
  let sourceDate;
  if (fromZone.value === 'local') {
    sourceDate = now;
  } else if (fromZone.value === 'UTC') {
    sourceDate = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate(), parseInt(hours), parseInt(minutes)));
  } else {
    // Convert from specific timezone to UTC first
    const formatter = new Intl.DateTimeFormat('en-US', {
      timeZone: fromZone.value,
      year: 'numeric',
      month: 'numeric',
      day: 'numeric',
      hour: 'numeric',
      minute: 'numeric',
      hour12: false
    });
    const parts = formatter.formatToParts(now);
    const dateParts = {};
    parts.forEach(part => {
      if (part.type !== 'literal') {
        dateParts[part.type] = part.value;
      }
    });
    sourceDate = new Date(`${dateParts.year}-${dateParts.month.padStart(2, '0')}-${dateParts.day.padStart(2, '0')}T${dateParts.hour.padStart(2, '0')}:${dateParts.minute.padStart(2, '0')}:00`);
  }
  
  // Convert to major time zones
  const conversions = [
    { name: 'GMT', zone: 'UTC' },
    { name: 'New York (EST/EDT)', zone: 'America/New_York' },
    { name: 'Chicago (CST/CDT)', zone: 'America/Chicago' },
    { name: 'Denver (MST/MDT)', zone: 'America/Denver' },
    { name: 'Los Angeles (PST/PDT)', zone: 'America/Los_Angeles' },
    { name: 'London (GMT/BST)', zone: 'Europe/London' },
    { name: 'Paris (CET/CEST)', zone: 'Europe/Paris' },
    { name: 'Dubai (GST)', zone: 'Asia/Dubai' },
    { name: 'Mumbai (IST)', zone: 'Asia/Kolkata' },
    { name: 'Singapore (SGT)', zone: 'Asia/Singapore' },
    { name: 'Tokyo (JST)', zone: 'Asia/Tokyo' },
    { name: 'Sydney (AEDT/AEST)', zone: 'Australia/Sydney' }
  ];
  
  results.innerHTML = conversions.map(conv => {
    const convertedTime = sourceDate.toLocaleTimeString('en-US', {
      timeZone: conv.zone,
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    });
    
    const convertedDate = sourceDate.toLocaleDateString('en-US', {
      timeZone: conv.zone,
      month: 'short',
      day: 'numeric'
    });
    
    const localDate = now.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric'
    });
    
    const dateDiff = convertedDate !== localDate ? ` (${convertedDate})` : '';
    
    return `
      <div class="conversion-item">
        <div class="conversion-zone">${conv.name}</div>
        <div class="conversion-time">${convertedTime}</div>
        ${dateDiff ? `<div class="conversion-date-diff">${dateDiff}</div>` : ''}
      </div>
    `;
  }).join('');
  
  results.classList.remove('hidden');
}

// Copy Functions
async function copyTimezone(city, time) {
  const text = `${city}: ${time}`;
  try {
    await navigator.clipboard.writeText(text);
    showSuccess(`Copied: ${text}`);
  } catch (error) {
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    showSuccess(`Copied: ${text}`);
  }
}

// Section Toggle
function toggleSection(sectionName) {
  const content = document.getElementById(`${sectionName}Content`);
  const toggle = document.getElementById(`${sectionName}Toggle`);
  
  if (content.classList.contains('collapsed')) {
    content.classList.remove('collapsed');
    toggle.textContent = '‚ñº';
    localStorage.setItem(`timeRef_${sectionName}_collapsed`, 'false');
  } else {
    content.classList.add('collapsed');
    toggle.textContent = '‚ñ∂';
    localStorage.setItem(`timeRef_${sectionName}_collapsed`, 'true');
  }
}

// Success notification helper
function showSuccess(message) {
  if (window.showNotification) {
    window.showNotification(message, 'success');
  } else {
    // Simple fallback
    const notification = document.createElement('div');
    notification.textContent = message;
    notification.style.cssText = `
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--accent-primary);
      color: white;
      padding: 1rem;
      border-radius: 0.5rem;
      z-index: 1000;
      font-size: 0.875rem;
    `;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 3000);
  }
}

// Event Listeners
document.addEventListener('DOMContentLoaded', () => {
  initTheme();
  
  // Load collapsed states
  const worldCollapsed = localStorage.getItem('timeRef_world_collapsed') === 'true';
  
  if (worldCollapsed) toggleSection('world');
  
  // Initial render
  renderTimezones();
  
  // Start time updates
  updateTimes();
  updateAllTimezones();
  setInterval(() => {
    updateTimes();
    updateAllTimezones();
  }, 1000);
  
  if (localStorage.getItem('sss_large') === 'true') {
    document.body.classList.add('text-lg');
  }
});

// Search functionality
let searchTimeout;
document.getElementById('globalSearch').addEventListener('input', (e) => {
  clearTimeout(searchTimeout);
  searchTimeout = setTimeout(() => {
    applySearch(e.target.value);
  }, 150);
});
</script>

</body>
</html>